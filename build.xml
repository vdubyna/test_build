<?xml version="1.0" encoding="UTF-8"?>
<project name="Application" default="checkout">

    <property name="artifactsDir" value="${basedir}/tests/artifacts" description="Base dir for all output of build commands" />

    <target name="prepare">
        <delete includeemptydirs="true" description="Clear artifacts dir">
            <fileset dir="${artifactsDir}" includes="**/*" />
        </delete>

        <mkdir dir="${artifactsDir}/" />
    </target>

    <target name="phpunit" depends="prepare">
        <mkdir dir="${artifactsDir}/phpunit/" description="Make sure that artifacts directory exists" />

        <exec dir="${basedir}" executable="phpunit" failonerror="true" output="${artifactsDir}/phpunit.log" >
            <arg line="--configuration ${basedir}/tests/phpunit.xml" />
        </exec>
    </target>

    <target name="phpunit-html-report" depends="prepare">
        <mkdir dir="${artifactsDir}/phpunit/" description="Make sure that artifacts directory exists" />

        <exec dir="${basedir}" executable="phpunit" failonerror="true" output="${artifactsDir}/phpunit.log">
            <arg line="--configuration ${basedir}/tests/phpunit.xml" />
            <arg line="--coverage-html ${artifactsDir}/phpunit/report" />
        </exec>

        <zip destfile="${artifactsDir}/coverage.zip" basedir="${artifactsDir}/phpunit/report" whenempty="skip" />
    </target>
</project>